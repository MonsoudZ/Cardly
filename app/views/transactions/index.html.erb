<div class="page-container max-w-4xl">
  <div class="section-header">
    <div>
      <h1 class="section-title">My Transactions</h1>
      <p class="section-subtitle">Manage your purchase offers and trade requests</p>
    </div>
  </div>

  <!-- Offers Received -->
  <% if @received_offers.any? %>
    <div class="mb-8">
      <h2 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center">
        Offers Received
        <%= render 'shared/components/badge', text: @received_offers.count, variant: :primary, size: :sm, class: 'ml-2' %>
      </h2>
      <div class="card divide-y divide-neutral-100">
        <% @received_offers.each do |transaction| %>
          <div class="p-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <img src="<%= transaction.listing.brand_display_logo %>" alt="" class="w-12 h-8 object-contain rounded bg-neutral-50 p-1">
              <div>
                <p class="font-medium text-neutral-900">
                  <%= transaction.buyer.display_name %> wants to
                  <% if transaction.sale? %>
                    buy your <%= transaction.brand_name %> card
                  <% else %>
                    trade for your <%= transaction.brand_name %> card
                  <% end %>
                </p>
                <p class="text-sm text-neutral-500">
                  <% if transaction.sale? %>
                    Purchase price: <%= number_to_currency(transaction.amount) %>
                  <% else %>
                    Offering: <%= transaction.offered_gift_card.brand_name %> (<%= number_to_currency(transaction.offered_gift_card.balance) %>)
                  <% end %>
                  · <%= time_ago_in_words(transaction.created_at) %> ago
                </p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <%= link_to transaction_path(transaction), class: "btn-ghost btn-sm" do %>
                View
              <% end %>
              <%= button_to accept_transaction_path(transaction), method: :post, class: "btn-sm bg-success-600 text-white hover:bg-success-500 rounded-button font-medium" do %>
                Accept
              <% end %>
              <%= button_to reject_transaction_path(transaction), method: :post, class: "btn-sm bg-danger-100 text-danger-700 hover:bg-danger-200 rounded-button font-medium", data: { turbo_confirm: "Are you sure you want to reject this offer?" } do %>
                Reject
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Offers Sent -->
  <% if @sent_offers.any? %>
    <div class="mb-8">
      <h2 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center">
        Offers Sent
        <%= render 'shared/components/badge', text: @sent_offers.count, variant: :secondary, size: :sm, class: 'ml-2' %>
      </h2>
      <div class="card divide-y divide-neutral-100">
        <% @sent_offers.each do |transaction| %>
          <div class="p-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <img src="<%= transaction.listing.brand_display_logo %>" alt="" class="w-12 h-8 object-contain rounded bg-neutral-50 p-1">
              <div>
                <p class="font-medium text-neutral-900">
                  <% if transaction.sale? %>
                    Buying <%= transaction.brand_name %> card from <%= transaction.seller.display_name %>
                  <% else %>
                    Trading for <%= transaction.brand_name %> card with <%= transaction.seller.display_name %>
                  <% end %>
                </p>
                <p class="text-sm text-neutral-500">
                  <% if transaction.sale? %>
                    Price: <%= number_to_currency(transaction.amount) %>
                  <% else %>
                    Your offer: <%= transaction.offered_gift_card.brand_name %> (<%= number_to_currency(transaction.offered_gift_card.balance) %>)
                  <% end %>
                  · <%= time_ago_in_words(transaction.created_at) %> ago
                </p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <%= render 'shared/components/badge', text: "Pending", variant: :warning, size: :sm %>
              <%= button_to cancel_transaction_path(transaction), method: :post, class: "btn-ghost btn-sm", data: { turbo_confirm: "Are you sure you want to cancel this offer?" } do %>
                Cancel
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- No Pending Offers -->
  <% if @received_offers.empty? && @sent_offers.empty? %>
    <div class="mb-8">
      <%= render 'shared/components/empty_state',
          icon: 'credit-card',
          title: 'No pending offers',
          description: 'Browse the marketplace to find gift cards to buy or trade.',
          action_text: 'Browse Marketplace',
          action_path: marketplace_path %>
    </div>
  <% end %>

  <!-- Recent Completed -->
  <% if @completed.any? %>
    <div>
      <h2 class="text-lg font-semibold text-neutral-900 mb-4">Recent Completed</h2>
      <div class="card divide-y divide-neutral-100">
        <% @completed.each do |transaction| %>
          <div class="p-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <img src="<%= transaction.listing.brand_display_logo %>" alt="" class="w-12 h-8 object-contain rounded bg-neutral-50 p-1">
              <div>
                <p class="font-medium text-neutral-900">
                  <%= transaction.brand_name %> card
                  <% if transaction.buyer == current_user %>
                    <span class="text-success-600">(Purchased)</span>
                  <% else %>
                    <span class="text-secondary-600">(Sold)</span>
                  <% end %>
                </p>
                <p class="text-sm text-neutral-500">
                  <% if transaction.sale? %>
                    <%= number_to_currency(transaction.amount) %>
                  <% else %>
                    Traded
                  <% end %>
                  · <%= time_ago_in_words(transaction.updated_at) %> ago
                </p>
              </div>
            </div>
            <%= render 'shared/components/badge', text: "Completed", variant: :success, size: :sm %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
