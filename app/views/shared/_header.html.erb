<header class="bg-white border-b border-primary-100 shadow-soft sticky top-0 z-50">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">
      <!-- Logo -->
      <%= link_to root_path, class: "flex items-center gap-2 group" do %>
        <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center shadow-soft group-hover:shadow-card transition-shadow">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
          </svg>
        </div>
        <span class="text-xl font-bold text-primary-600">Cardly</span>
      <% end %>

      <!-- Desktop Navigation -->
      <div class="hidden sm:flex sm:items-center">
        <div class="flex space-x-1">
          <%= link_to "Marketplace", marketplace_path, class: "nav-link hover:text-primary-600" %>
          <%= link_to "Brands", brands_path, class: "nav-link hover:text-primary-600" %>
          <% if user_signed_in? %>
            <%= link_to "My Wallet", wallet_path, class: "nav-link hover:text-primary-600" %>
          <% end %>
        </div>

        <div class="flex items-center ml-8 space-x-4">
          <% if user_signed_in? %>
            <!-- User Dropdown -->
            <div class="relative" data-controller="dropdown">
              <button type="button" class="flex items-center gap-x-2 text-neutral-600 hover:text-primary-600 transition-colors" data-action="click->dropdown#toggle">
                <%= render 'shared/components/avatar',
                    name: current_user.display_name,
                    image_url: current_user.avatar.presence,
                    size: :sm %>
                <span class="hidden lg:flex lg:items-center">
                  <span class="text-sm font-medium text-neutral-900">
                    <%= current_user.display_name %>
                  </span>
                  <svg class="ml-1.5 h-4 w-4 text-neutral-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                  </svg>
                </span>
              </button>

              <div data-dropdown-target="menu" class="hidden absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-card bg-white shadow-elevated ring-1 ring-neutral-900/5 transition-all opacity-0 scale-95">
                <div class="py-1">
                  <!-- User Info -->
                  <div class="px-4 py-3 border-b border-neutral-100">
                    <p class="text-sm font-medium text-neutral-900"><%= current_user.display_name %></p>
                    <p class="text-xs text-neutral-500 truncate"><%= current_user.email %></p>
                  </div>

                  <%= link_to transactions_path, class: "dropdown-item flex items-center" do %>
                    <%= render 'shared/components/icon', name: 'credit-card', size: :sm, color: 'text-neutral-400' %>
                    <span class="ml-3">Transactions</span>
                    <% if current_user.pending_offers_received.any? %>
                      <%= render 'shared/components/badge', text: current_user.pending_offers_received.count, variant: :primary, size: :sm, class: 'ml-auto' %>
                    <% end %>
                  <% end %>

                  <%= link_to favorites_path, class: "dropdown-item flex items-center" do %>
                    <%= render 'shared/components/icon', name: 'heart', size: :sm, color: 'text-neutral-400' %>
                    <span class="ml-3">Watchlist</span>
                    <% if current_user.favorites.active_listings.any? %>
                      <%= render 'shared/components/badge', text: current_user.favorites.active_listings.count, variant: :neutral, size: :sm, class: 'ml-auto' %>
                    <% end %>
                  <% end %>

                  <div class="border-t border-neutral-100 my-1"></div>

                  <%= link_to profile_path, class: "dropdown-item flex items-center" do %>
                    <%= render 'shared/components/icon', name: 'user', size: :sm, color: 'text-neutral-400' %>
                    <span class="ml-3">Profile</span>
                  <% end %>

                  <%= link_to edit_profile_path, class: "dropdown-item flex items-center" do %>
                    <%= render 'shared/components/icon', name: 'cog', size: :sm, color: 'text-neutral-400' %>
                    <span class="ml-3">Settings</span>
                  <% end %>

                  <% if current_user.admin? %>
                    <div class="border-t border-neutral-100 my-1"></div>
                    <%= link_to admin_root_path, class: "dropdown-item flex items-center" do %>
                      <%= render 'shared/components/icon', name: 'shield-check', size: :sm, color: 'text-secondary-500' %>
                      <span class="ml-3 text-secondary-600">Admin Dashboard</span>
                    <% end %>
                  <% end %>

                  <div class="border-t border-neutral-100 my-1"></div>

                  <%= button_to destroy_user_session_path, method: :delete, class: "dropdown-item-danger flex items-center w-full text-left" do %>
                    <%= render 'shared/components/icon', name: 'arrow-right', size: :sm, color: 'text-danger-400' %>
                    <span class="ml-3">Sign Out</span>
                  <% end %>
                </div>
              </div>
            </div>
          <% else %>
            <%= link_to "Sign In", new_user_session_path, class: "nav-link hover:text-primary-600" %>
            <%= render 'shared/components/button', text: "Sign Up", href: new_user_registration_path, variant: :primary, size: :sm %>
          <% end %>
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="sm:hidden" data-controller="dropdown">
        <button type="button" class="text-neutral-600 hover:text-primary-600 p-2" data-action="click->dropdown#toggle">
          <span class="sr-only">Open main menu</span>
          <%= render 'shared/components/icon', name: 'menu', size: :lg %>
        </button>

        <!-- Mobile menu -->
        <div data-dropdown-target="menu" class="hidden absolute top-16 inset-x-0 bg-white shadow-elevated border-t border-neutral-100 transition-all opacity-0 scale-95">
          <div class="px-4 py-3 space-y-1">
            <%= link_to "Marketplace", marketplace_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
            <%= link_to "Brands", brands_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
            <% if user_signed_in? %>
              <%= link_to "My Wallet", wallet_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <div class="border-t border-neutral-100 my-2"></div>
              <%= link_to "Transactions", transactions_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <%= link_to "Watchlist", favorites_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <%= link_to "Profile", profile_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <%= link_to "Settings", edit_profile_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <div class="border-t border-neutral-100 my-2"></div>
              <%= button_to "Sign Out", destroy_user_session_path, method: :delete, class: "block w-full text-left py-2 text-danger-600" %>
            <% else %>
              <div class="border-t border-neutral-100 my-2"></div>
              <%= link_to "Sign In", new_user_session_path, class: "block py-2 text-neutral-700 hover:text-primary-600" %>
              <%= link_to "Sign Up", new_user_registration_path, class: "block py-2 font-medium text-primary-600" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
