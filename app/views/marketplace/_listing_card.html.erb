<div class="card-elevated hover-lift group relative" id="<%= dom_id(listing) %>">
  <!-- Favorite Button -->
  <% if user_signed_in? && listing.user != current_user %>
    <div class="absolute top-3 right-3 z-10">
      <% if current_user.favorited?(listing) %>
        <%= button_to listing_favorite_path(listing), method: :delete, class: "p-2 bg-white/90 rounded-full shadow-soft hover:bg-white text-primary-500 hover:text-primary-600 transition", data: { turbo_frame: dom_id(listing) }, title: "Remove from watchlist" do %>
          <%= render 'shared/components/icon', name: 'heart', size: :sm, filled: true %>
        <% end %>
      <% else %>
        <%= button_to listing_favorite_path(listing), method: :post, class: "p-2 bg-white/90 rounded-full shadow-soft hover:bg-white text-neutral-400 hover:text-primary-500 transition", data: { turbo_frame: dom_id(listing) }, title: "Add to watchlist" do %>
          <%= render 'shared/components/icon', name: 'heart', size: :sm %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <%= link_to listing_path(listing), class: "block" do %>
    <div class="p-4">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
          <img src="<%= listing.brand_display_logo %>" alt="<%= listing.brand_name %>" class="w-12 h-8 object-contain">
          <div>
            <h3 class="font-semibold text-neutral-900 group-hover:text-primary-600 transition-colors"><%= listing.brand_name %></h3>
            <div class="flex items-center text-sm text-neutral-500">
              <span>by <%= link_to listing.user.display_name, user_path(listing.user), class: "hover:text-primary-600 hover:underline", onclick: "event.stopPropagation()" %></span>
              <% if listing.user.rating_count > 0 %>
                <span class="mx-1">·</span>
                <%= render 'shared/components/icon', name: 'star', size: :xs, filled: true, color: 'text-warning-400' %>
                <span class="ml-0.5"><%= listing.user.average_rating %></span>
              <% end %>
            </div>
          </div>
        </div>
        <% if listing.sale? %>
          <%= render 'shared/components/badge', text: "For Sale", variant: :success, size: :sm %>
        <% else %>
          <%= render 'shared/components/badge', text: "For Trade", variant: :secondary, size: :sm %>
        <% end %>
      </div>

      <div class="flex justify-between items-end">
        <div>
          <p class="text-sm text-neutral-500">Card Value</p>
          <p class="text-lg font-semibold text-neutral-900"><%= number_to_currency(listing.balance) %></p>
        </div>
        <% if listing.sale? %>
          <div class="text-right">
            <p class="text-sm text-neutral-500">Asking Price</p>
            <p class="text-lg font-bold text-primary-600"><%= number_to_currency(listing.asking_price) %></p>
            <% if listing.discount_percentage.present? && listing.discount_percentage > 0 %>
              <p class="text-xs text-success-600 font-medium">Save <%= listing.discount_percentage %>%</p>
            <% end %>
          </div>
        <% else %>
          <div class="text-right">
            <p class="text-sm text-neutral-500">Looking for</p>
            <p class="text-sm text-neutral-700"><%= truncate(listing.trade_preferences, length: 30) %></p>
          </div>
        <% end %>
      </div>
    </div>

    <div class="px-4 py-3 bg-neutral-50 border-t border-neutral-100">
      <div class="flex items-center justify-between text-sm">
        <span class="text-neutral-500">Listed <%= time_ago_in_words(listing.created_at) %> ago</span>
        <span class="text-primary-600 font-medium group-hover:text-primary-500">View Details →</span>
      </div>
    </div>
  <% end %>
</div>
